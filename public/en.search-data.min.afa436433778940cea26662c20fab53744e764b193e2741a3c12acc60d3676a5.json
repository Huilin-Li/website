[{"id":0,"href":"/posts/python/","title":"Helpul python/pandas scripts","section":"blog","content":"So\u0026hellip;, I find I used these codes a lot, and they are very helpful for effectivity.\nAssign files into different folders\r#\rAssuming I have 230 files in db_folder, and I want to copy these 230 files into different folders (folder0, folder1 and so on) with at least 50 files in each folder.\nfiles_list contains names of these 230 files, like files_list=[\u0026quot;file1\u0026quot;, \u0026quot;file2\u0026quot;, ..., \u0026quot;file230\u0026quot;]\nimport shutil chunks = [files_list[x:x+50] for x in range(0, len(files_list), 50)] # len(chunks) = 5 for i in range(53): chunk = chunks[i] newpath = \u0026#34;db_folder/folder\u0026#34; + str(i) if not os.path.exists(newpath): os.makedirs(newpath) for j in chunk: src = \u0026#34;db_folder/\u0026#34; + j dst = \u0026#34;db_folder/folder\u0026#34; + str(i) + \u0026#34;/\u0026#34; + j shutil.copyfile(src, dst) Copy files to a new folder\r#\rimport shutil for i in files_list: src = \u0026#34;old_folder/\u0026#34; + i dst = \u0026#34;new_folder/\u0026#34; + i shutil.copyfile(src, dst) Remove legend in Plotly\r#\rfig.update_layout(showlegend=False) "},{"id":1,"href":"/posts/pymol/","title":"PyMol commands","section":"blog","content":" select residues based on residue number select nterm, resi 42+74+43+56+39 mutate one amino acid cmd.wizard(\u0026#34;mutagenesis\u0026#34;) cmd.fetch(\u0026#34;target.pdb\u0026#34;) cmd.get_wizard().set_mode(\u0026#34;LEU\u0026#34;) cmd.get_wizard().do_select(\u0026#34;chain A and resid 22\u0026#34;) cmd.get_wizard().apply() cmd.save(\u0026#34;mutated_target.pdb\u0026#34;) "},{"id":2,"href":"/docs/project/binderdesign/truncation/","title":"truncation","section":"Binder Design","content":"\rtarget.pdb preprocessing\r#\rAssuming we have a target protein target.pdb, and we want to create a binder to target.pdb. The first step is preprocessing target.pdb. Generally spearking, there are two steps we need to think of.\nTruncating target.pdb\r#\rTruncating target protein helps a lot in reducing the stress of computing. For example, we could remove AAs with very low pLDDT or AAs who are far away from the place we want binders to bind with.\ndef residue_remove(pdbfile, remove_ids, outputName): \u0026#34;\u0026#34;\u0026#34; Remove residues based on positions. Assumption: pdbfile only has A chain \u0026#34;\u0026#34;\u0026#34; residue_to_remove = [] pdb_io = PDB.PDBIO() pdb_parser = PDB.PDBParser() structure = pdb_parser.get_structure(\u0026#34; \u0026#34;, pdbfile) model = structure[0] chain = model[\u0026#34;A\u0026#34;] # assuming pdbfile only has A chain for residue in chain: id = residue.id if id[1] in remove_ids: residue_to_remove.append(residue.id) for residue in residue_to_remove: chain.detach_child(residue) pdb_io.set_structure(structure) pdb_io.save(outputName) return # truncating ids truncating_ids = [1,2,3] # remove some AAs residue_remove(pdbfile=\u0026#34;target.pdb\u0026#34;, remove_ids=truncating_ids, outputName=\u0026#34;truncation.pdb\u0026#34;) This step can also be achieved in PyMol.\nHow many we can remove from our target protein?\nAt the very beginning, I was thinking removing all useless AAs. For example, I was creating a binder to a transmembrane protein, and I only left the part of protein which is located at the outside of the whole protein. Unfornutately, this part of protein I aim to create binders to bind with is too \u0026ldquo;thin\u0026rdquo; to lead design binders correctly.\nIf the \u0026ldquo;target\u0026rdquo; protein you feed into the RFdiffusion model is too small, ppi.hotspot_res argument becomes ineffective. Let\u0026rsquo;s imagine the \u0026ldquo;target\u0026rdquo; protein we feed into the RFdiffusion model is a paper, and ppi.hotspot_res is located somewhere in this paper. Since this \u0026ldquo;target\u0026rdquo; protein (the paper) is too thin, RFdiffusion model feels confused about which side (above or below the paper ) the ppi.hotspot_res points to.\nMy suggestion would be to try some different trunctations and pick one that can approcimately balance the computation stress and correct leading of bidner design.\nReset AAs\u0026rsquo; residues numbers in truncation.pdb\r#\rNormally, after removing some AAs, the residues number in truncation.pdb becomes discontinuous, and we want to concatenate them again and update their residue number with continuous numbers.\ndef update_resnum(pdbfile): \u0026#34;\u0026#34;\u0026#34; üåü CHANGE RESIDUE NUMBER Assumption: pdbfile only has A chain \u0026#34;\u0026#34;\u0026#34; pdb_io = PDB.PDBIO() pdb_parser = PDB.PDBParser() structure = pdb_parser.get_structure(\u0026#34; \u0026#34;, pdbfile) model = structure[0] chain = model[\u0026#34;A\u0026#34;] print(len([i for i in chain.get_residues()])) new_resnums = list(range(1, 1+len([i for i in chain.get_residues()]))) for i, residue in enumerate(chain.get_residues()): res_id = list(residue.id) res_id[1] = new_resnums[i] residue.id = tuple(res_id) pdb_io.set_structure(structure) pdb_io.save(pdbfile.split(\u0026#39;.pdb\u0026#39;)[0] + \u0026#39;_update_resnum.pdb\u0026#39;) return "},{"id":3,"href":"/docs/project/binderdesign/design/","title":"design binders via RFdiffusion and ProteinMPNN-FastRelax","section":"Binder Design","content":"In my use case, firstly, I tried to de novo design binders. However, I found that designed binders are limited to proteins with only one helix. Then, I changed to design binders based on scaffolds. The design process and scripts I used a lot are as follows.\nThree designing environments\r#\rThanks a lot to the great work, RFdiffusion and ProteinMPNN-FastRelax, as well as AlphaFold2, who give us great ways to design proteins.\n1Ô∏è‚É£ RFdiffuion for desigining protein backbones, under SE3nv environment. 2Ô∏è‚É£ ProteinMPNN-FastRelax for desiging protein sequences, under dl_binder_design environment. 3Ô∏è‚É£ AlphaFold2 for evaluating designed proteins, under af2_binder_design environment.\nWe will design binders under these three environment: SE3nv environment, dl_binder_design environment, af2_binder_design environment.\nQuickly go through the whole process\r#\rLet us say that we want to design binders for target.pdb, and our directories tree is\n‚îú‚îÄ‚îÄ dl_binder_design\r‚îÇ¬†‚îú‚îÄ‚îÄ af2_initial_guess\r‚îÇ¬†‚îÇ¬†‚îú‚îÄ‚îÄ predict.py\r‚îÇ¬†‚îú‚îÄ‚îÄ mpnn_fr\r‚îÇ¬†‚îÇ¬†‚îú‚îÄ‚îÄ dl_interface_design.py\r‚îú‚îÄ‚îÄ mydesigns\r‚îÇ¬†‚îú‚îÄ‚îÄ target\r‚îÇ¬†‚îÇ¬†‚îî‚îÄ‚îÄ target.pdb\r‚îÇ¬†‚îú‚îÄ‚îÄ OutputFolder\r‚îÇ¬†‚îÇ¬†‚îú‚îÄ‚îÄ A28-A25-A29-A26-A63_0.pdb\r‚îÇ¬†‚îÇ¬†‚îú‚îÄ‚îÄ A28-A25-A29-A26-A63_0.trb\r‚îÇ¬†‚îÇ¬†‚îú‚îÄ‚îÄ backbones.silent\r‚îÇ¬†‚îÇ¬†‚îú‚îÄ‚îÄ out.silent\r‚îú‚îÄ‚îÄ RFdiffusion\r‚îÇ¬†‚îú‚îÄ‚îÄ rfdiffusion\r‚îÇ¬†‚îú‚îÄ‚îÄ scripts\r‚îÇ¬†‚îÇ¬†‚îî‚îÄ‚îÄ run_inference.py backbones design script\r#\r"},{"id":4,"href":"/docs/project/binderdesign/hotspot/","title":"ppi.hotspot_res argument","section":"Binder Design","content":"\rppi.hotspot_res argument\r#\rI spent a great of time on ppi.hotspot_res argument.\nIn this blog, I want to make notes on how I design the binder of the target protein using RFdiffusion, ProteinMPNN-FastRelax and so on.\ndef point_to_plane_dist(p, p0, p1, p2): \u0026#34;\u0026#34;\u0026#34; The distance from point p to the plane determined by three points (p0, p1, p2) :param p: point p :param p0, p1, p2: three points determine one plane :return: the distance between point to plane \u0026#34;\u0026#34;\u0026#34; u = p1 - p0 v = p2 - p0 # vector normal to plane n = np.cross(u, v) n /= np.linalg.norm(n) p_ = p - p0 dist_to_plane = np.dot(p_, n) return dist_to_plane Step1: Load the target protein.\r#\rThe pdb file can be downloaded here.\ntarget_pdb = PandasPdb().read_pdb(\u0026#39;AF-A2VEY9-F1-model_v4.pdb\u0026#39;) # read structure information into pd.DataFrame target_df = target_pdb.df[\u0026#39;ATOM\u0026#39;] Step2: Truncate target protein\r#\rFor example, I want to remove AAs with very low pLDDT and AAs who are located in the cell membrane. By selecting the most big dark green area, we exclude AAs with very low pLDDT score from highlighted areas. We collect positions of AAs with very low pLDDT are (1-13, 336-693).\nhttps://alphafold.ebi.ac.uk/entry/A2VEY9\nAt the same time, we can get positions of AAs who are located in the transmembrane parts from Subcellular Location section here.\nhttps://www.uniprot.org/uniprotkb/A2VEY9/entry#subcellular_location\n# truncating ids truncating_ids = set(list(range(1,14))+list(range(336,694))+list(range(43,64))+list(range(72,93))+list(range(191,212))+list(range(233,254))+list(range(347,368))) len(truncating_ids) #=455 residue_remove(pdbfile=\u0026#34;AF-A2VEY9-F1-model_v4.pdb\u0026#34;, remove_ids=truncating_ids, outputName=\u0026#34;truncation.pdb\u0026#34;) Let\u0026rsquo;s check this truncated protein in PyMol! We can see that the original protein becomes two much smaller parts, but these two parts are more robust to analysis in next steps.\nOriginal protein (red) and Truncated protein(green)\nStep3. Visualize truncation.pdb with only ùê∂ùõΩ ATOM\r#\rHere, we take ùê∂ùõΩ ATOM as the represent of each AA.\ntruncation = PandasPdb().read_pdb(\u0026#34;truncation.pdb\u0026#34;) cols = [\u0026#34;atom_name\u0026#34;, \u0026#34;residue_name\u0026#34;, \u0026#34;residue_number\u0026#34;, \u0026#34;x_coord\u0026#34;, \u0026#34;y_coord\u0026#34;, \u0026#34;z_coord\u0026#34;] df = truncation.df[\u0026#34;ATOM\u0026#34;][cols] df_CB = df[df[\u0026#34;atom_name\u0026#34;]==\u0026#34;CB\u0026#34;] # visualization fig = go.Figure(data=[go.Scatter3d(x=df_CB[\u0026#34;x_coord\u0026#34;], y=df_CB[\u0026#34;y_coord\u0026#34;], z=df_CB[\u0026#34;z_coord\u0026#34;], name=\u0026#34;\u0026#34;, hoverinfo=\u0026#34;text\u0026#34;, hovertext=df_CB[\u0026#34;residue_number\u0026#34;], mode=\u0026#34;markers\u0026#34;, marker=dict(color=\u0026#34;gray\u0026#34;, size=5))]) fig.update_layout( width=1100, height=1100, margin=dict(l=0, r=0, b=0, t=0), scene=dict(xaxis_title=\u0026#39;x coord\u0026#39;, yaxis_title=\u0026#39;y coord\u0026#39;, zaxis_title=\u0026#39;z coord\u0026#39;)) fig.show() "},{"id":5,"href":"/docs/project/binderdesign/analysis/","title":"Notes","section":"Binder Design","content":" scaffold-based binder design performs much better than de novo binder design Experiments I tried\r#\rArgument Observation Star complete target protein + given scaffolds designed binders are motsly limited to 3-helix prorein complete target protein + given scaffolds (10,000) "},{"id":6,"href":"/posts/proteinstruture/","title":"4 levels of protein structure","section":"blog","content":"There are four levels of protein structure: primary, secondary, tertiary and quaternary.\nPrimary Structure.\r#\rA protein‚Äôs primary structure is the unique sequence of amino acids in each polypeptide chain that makes up the protein.\nfasta file sequence of 20 amino acids Secondary Structure\r#\rReference:\r#\r3.9: Proteins - Protein Structure "},{"id":7,"href":"/posts/overleaf/","title":"All about Latex and Overleaf","section":"blog","content":"\\documentclass{article}\r\\usepackage[utf8]{inputenc}\r\\usepackage{tcolorbox}\r\\newtcbox{\\inlinecode}{on line, boxrule=0pt, boxsep=0pt, top=2pt, left=2pt, bottom=2pt, right=2pt, colback=gray!15, colframe=white, fontupper={\\ttfamily \\footnotesize}}\r\\begin{document}\rThis is a sample of some inline code: \\inlinecode{int x = 0;}.\r\\end{document} Remove the space on the left hand of the beginning of a paragraph \\noindent Typeseeting programming packages/libraries in LaTex \\textsc{} "},{"id":8,"href":"/posts/shell/","title":"Bash Scripts","section":"blog","content":"\rBash Scripts\r#\rHow to discard changes in VScode?\r#\rNavigate to reporsitory (has .github folder) with changes. Then, git restore \u0026lt;file\u0026gt; Activate conda environment in bash script\r#\rsource ~/miniconda3/etc/profile.d/conda.sh conda activate ENV SBATCH Array jobs\r#\r#SBATCH -J array-job\t#SBATCH -a 1-3 #SBATCH -o array-job.%A.%a.log id_list=\u0026#34;./id_list.txt\u0026#34; id=`head -n $SLURM_ARRAY_TASK_ID $id_list | tail -n 1` python3 script.py -in $id srun gpu\r#\rsrun -N 1 --ntasks-per-node 2 -p v100 -q gpu --gres=gpu:1 --mem=50G --pty /bin/bash run scripts\r#\rsbatch test.slm check sequence process\r#\rsqueue -u username cancel sequence\r#\rscancel jobID copy files into another folder\r#\rcp ./*.pdb ../newfoler "},{"id":9,"href":"/tools/","title":"contact","section":"Introduction","content":"\rContact\r#\rOutlook: LHLLIHUILIN@outlook.com UniEmail: lihuilin@westlake.edu.cn Gmail: lihuilin023@gmail.com "},{"id":10,"href":"/posts/plane/","title":"Drawing a plane perpendicular to a given line in Plotly","section":"blog","content":"When I am working on my binder design task, I need to select suitable hotspot residues that can lead to design better binders. In addition to hydrophobic amino acids, I also want to focus on the amino acids whose positions are close to the outside edge, and far away from the center of the protein. Therefore, I expect a plane that can approximately cut the protein layer by layer with my expected distance to the outside edge.\nBy calculating the centers of two parts of my protein, I can easily determine one line. However, it took me lots of time to find the plane that can be perpendicular to this line.\nFinally, I find the solution! üí™ TL;DR, code is here!\nA plane perpendicular to the given line\nAssuming that we want to make a plane whose vertical distance to $p_1$ is $d01$. We can determine the point $p0$ by\nfrom shapely.geometry import LineString line = LineString([p1, p2]) p0_tmp = line.interpolate(d01) p0 = np.array([p0_tmp.x, p0_tmp.y, p0_tmp.z]) 5 important points who determine the plane\nFinding $p_3$, $p_4$, $p_5$ and $p_6$ took me lots of time. I finally find that they can be found by vector calculation. For example, we want the distance between $p_0$ and $p_3$/$p_4$/$p_5$/$p_6$ is $Radius = 3$. P1 = p0 P2 = p2 Radius = 3 V3 = P1 - P2 V3 = V3 / np.linalg.norm(V3) e = np.array([0,0,0]) e[np.argmin(np.abs(V3))] = 1 V1 = np.cross(e, V3) V1 = V1 / np.linalg.norm(V3) V2 = np.cross(V3, V1) # p3 90 degree s3 = np.pi/2 p3 = P1 + Radius*( np.cos(s3)*V1 + np.sin(s3)*V2 ) # p4 180 degree s4 = np.pi p4 = P1 + Radius*( np.cos(s4)*V1 + np.sin(s4)*V2 ) # p5 270 degree s5 = np.pi*1.5 p5 = P1 + Radius*( np.cos(s5)*V1 + np.sin(s5)*V2 ) # p6 0 degree s6 = 0 p6 = P1 + Radius*( np.cos(s6)*V1 + np.sin(s6)*V2 ) Becasue three points determine one plane. We can finally make the plane by\nplane1_x, plane1_y, plane1_z = np.array([p6, p3, p5]).T fig.add_trace(go.Mesh3d(x=plane1_x, y=plane1_y, z=plane1_z, color=\u0026#34;lightgreen\u0026#34;, name = \u0026#34;\u0026#34;, hoverinfo=\u0026#34;skip\u0026#34;, opacity=0.50)) plane2_x, plane2_y, plane2_z = np.array([p4, p3, p5]).T fig.add_trace(go.Mesh3d(x=plane2_x, y=plane2_y, z=plane2_z, color=\u0026#34;lightgreen\u0026#34;, name = \u0026#34;\u0026#34;, hoverinfo=\u0026#34;skip\u0026#34;, opacity=0.50)) "},{"id":11,"href":"/posts/excel/","title":"Excel commands","section":"blog","content":" In one row, concat each cell into one cell as string =CONCAT(A1:D1) "},{"id":12,"href":"/posts/hugo/","title":"Hugo commands","section":"blog","content":"\rIntroduction\r#\rSome commands and issues you might want to know when building a website, including inserting images and resize and center images,adding emoji, travel map, linking to pages and titles, and so on.\nHow to insert images and resize and center images?\r#\rThe file tree is like\n‚îú‚îÄcontent\r‚îÇ ‚îÇ _index.md\r‚îÇ ‚îÇ\r‚îÇ ‚îî‚îÄposts\r‚îÇ ‚îÇ hugo.md\r‚îÇ ‚îÇ _index.md\r‚îÇ ‚îÇ\r‚îÇ ‚îî‚îÄimages\r‚îÇ Nice.png In hugo.md file, we add Nice.png and scale it by\n{{\u0026lt; figure src=\u0026#34;../images/Nice.png\u0026#34; width=\u0026#34;400\u0026#34; alt=\u0026#34; \u0026#34; \u0026gt;}} Why we need to add ../ in front of images folder, altough hugo.md file and images folder are at the same level? Because Hugo system sees hugo.md as a foler too. However, Hugo system sees _index.md as a file! Therefore, If we want to insert iamges in _index.md file, the command will be like:\n{{\u0026lt; figure src=\u0026#34;./images/Nice.png\u0026#34; width=\u0026#34;400\u0026#34; alt=\u0026#34; \u0026#34; \u0026gt;}} Center the image?\n\u0026lt;center\u0026gt;{ {\u0026lt;figure src=\u0026#34;../images/Nice.png\u0026#34; width=\u0026#34;400\u0026#34; alt=\u0026#34; \u0026#34;\u0026gt;} }\u0026lt;/center\u0026gt; At the same time, in hugo.toml, add\n[markup]\r[markup.goldmark]\r[markup.goldmark.renderer]\runsafe = true How to add emoji?\r#\rDirectly copy emoji icon üëã and paste to .md file, instead of using :wave:.\nEmoji Cheat Sheet: https://github.com/ikatyang/emoji-cheat-sheet/blob/master/README.md\nHow to add a travel map in Hugo?\r#\rRefer to this article\nNOTE:\nIn {{\u0026lt; openstreetmap mapName=\u0026quot;\u0026lt;your map name\u0026gt;\u0026quot; \u0026gt;}}, the \u0026lt;your map name\u0026gt; is not the name you give to your map, but the name in the website link of your map. For example, I created a map whose name is Travel, I need to use travel_1036974 in the hugo shortcode. Why my local website doesn\u0026rsquo;t update after I update my markdown files?\r#\rGood question. I also find my local website does not update although I have save my changes. I am not clear the excat reason, but It works well if I Pree Ctrl+C to stop the local host, and hugo server again, I can see the updated website in http://localhost:1313/.\nHow to link pages and tiles?\r#\rI am in now.md file now, and there is another page.md which has #Title I want to link. I want to link to page.md and link to #Title I want to link. In page.md file, add an anchor:\n# Title I want to link {#anchor} In now.md file, add commands:\n[text] ( {{\u0026lt; ref \u0026#34;./pages.md\u0026#34; \u0026gt;}} ) # link to one page [text] ( {{\u0026lt; ref \u0026#34;./pages.md#anchor\u0026#34; \u0026gt;}} ) # link to the title References\r#\rhugo book demo „ÄêHugo„Äëhugo-book‰∏ªÈ¢ò‰ΩøÁî® hugoÂçöÂÆ¢ ÊñáÂÜÖÊèíÂÖ•ÂõæÁâá How to render markdown url with .md to correct link Linking pages in Hugo/markdown "},{"id":13,"href":"/posts/hugobookgithubaction/","title":"Website via Hugo Book and deployed by Github Action","section":"blog","content":"\rIn Windows10, build personal website via Hugo-book and Github Actions\r#\rThis blog is about how to use Hugo to create the local website, and then deploy it on GitHub via Github Action. Everything is step by step.\nPrerequisites\r#\rGit Windows 10 VScode Github account Install Hugo\r#\rIn Windows10, right click Windows Powershell and click run as administrator. Refer to How to install chocolatey in Windows to install chocolatey. Refer to Install Hugo on Windows to install Hugo by choco install hugo-extended Make sure Hugo works well by hugo version and we will get the following\nhugo v0.123.7-312735366b20d64bd61bff8627f593749f86c964+extended windows/amd64 BuildDate=2024-03-01T16:16:06Z VendorInfo=gohugoio Create the website using Hugo themes\r#\rFor example, I want to locally work on my website in C:\\myweb folder. Still in Windows Powershell,\nNavigate back to C: driver, and create a new folder by typing mkdir myweb. Create the website by hugo new site Blogs cd Blogs git init Refer to Hugo Book Theme to use hugo-book theme by git submodule add https://github.com/alex-shpak/hugo-book themes/hugo-book Till now, if we run hugo server, we will get a plain website locally. In VS code, open Blogs folder.\nIn C:/myweb/Blogs/themes/hugo-book/exampleSite/content.en/, copy docs folder, posts folder and _index.md file to C:/myweb/Blogs/content/. Why I don\u0026rsquo;t copy the menu folder?\nBecause I found menu folder doesn\u0026rsquo;t work when I modified the website as I needed. We can customize the order of menus in leftbar by adding weight in the name.md file. For example, in each name.md file, the parameter weight determine the order of menues.\n---\rweight: 1\rtitle: One name.md file\r--- Run hugo server again, we will see a more well-done website. Deploy on Github by Action\r#\rCreate a public Github repository. For example, if this repository\u0026rsquo;s name is Blogs, your website link will be like this https://huilin-li.github.io/Blogs/\nStill in Windows Powershell, push your local work to this repository by cd C:/myweb/Blogs\rgit add .\rgit commit -m \u0026#34;update\u0026#34;\rgit branch -M main\rgit remote add origin https://github.com/Huilin-Li/Blogs.git\rgit push -u origin main Visit your GitHub repository. From the main menu choose Settings \u0026gt; Pages. In the center of your screen you will see this: Change the Source to GitHub Actions. Click Configure as the highlight in this picture: Go to Host on GitHub Pages, copy the yaml file in step 6 to Blogs/.github/workflows/hugo.yaml, and commit changes. As Step8, Step9, Step10 in Host on GitHub Pages, the deloyment is done. üéâ Update website\r#\rAdd more contents in C:/myweb/Blogs/content/ folder, and then git push to Github repository. Github Action will automaticaly update new contents in https://huilin-li.github.io/Blogs/.\nReferences\r#\rHow to install chocolatey in Windows Hugo with Git Hub Pages on Windows Using GitHub Pages with Actions to deploy Hugo sites in seconds - Tommy Byrd // HugoConf 2022 Hugo Book Theme Host on GitHub Pages „ÄêHugo„Äëhugo-book‰∏ªÈ¢ò‰ΩøÁî® "},{"id":14,"href":"/links/","title":"world","section":"Introduction","content":"\rWorld\r#\r"}]